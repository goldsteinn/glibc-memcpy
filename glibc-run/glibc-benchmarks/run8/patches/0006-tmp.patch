From 151206084e3d48470a6a04f9ba2242d1ccb7acea Mon Sep 17 00:00:00 2001
From: Noah Goldstein <goldstein.w.n@gmail.com>
Date: Wed, 25 Aug 2021 01:12:44 -0400
Subject: [PATCH 6/7] tmp

---
 benchtests/bench-memcpy-random.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/benchtests/bench-memcpy-random.c b/benchtests/bench-memcpy-random.c
index eeeef42fc1..47b42a13a9 100644
--- a/benchtests/bench-memcpy-random.c
+++ b/benchtests/bench-memcpy-random.c
@@ -17,7 +17,7 @@
    <https://www.gnu.org/licenses/>.  */
 
 #define MAX_TEST_SIZE (512*1024)
-#define MIN_PAGE_SIZE (3*MAX_TEST_SIZE+getpagesize())
+#define MIN_PAGE_SIZE (3*MAX_TEST_SIZE+getpagesize()+3*4096)
 #define TEST_MAIN
 #define TEST_NAME "memcpy"
 #include "bench-string.h"
@@ -168,17 +168,17 @@ do_one_fixed_test (json_ctx_t *json_ctx, impl_t *impl, char *dst, char *src,
 
 
 static size_t
-init_copy(size_t max_size, int dst_gt_src)
+init_copy(size_t max_size, size_t max_copy_size, int dst_gt_src)
 {
   size_t i, dst_offset, src_offset;
   if (dst_gt_src <= 0)
     {
       dst_offset = 0;
-      src_offset = max_size;
+      src_offset = max_size + max_copy_size;
     }
   else
     {
-      dst_offset = max_size;
+      dst_offset = max_size + max_copy_size;
       src_offset = 0;
     }
 
@@ -188,7 +188,7 @@ init_copy(size_t max_size, int dst_gt_src)
   for (i = 0; i < MAX_COPIES; i++)
     {
       dst_offset  = dst_gt_src == -1
-                        ? (rand() & 1) ? max_size : 0
+                        ? (rand() & 1) ? 2 * (max_size + max_copy_size) : 0
                         : dst_offset;
       copy[i].dst = (rand () & (max_size - 1));
       copy[i].dst &= ~dst_align_arr[rand () & ALIGN_MASK];
@@ -270,7 +270,7 @@ test_main (void)
       do_test (&json_ctx, i, -1);
     }
 
-  for (int i = 4096; i <= 65536; i = i * 2)
+  for (int i = 4096; i <= 131072; i = i * 2)
     {
       do_test_fixed_size (&json_ctx, i, i, 0);
       do_test_fixed_size (&json_ctx, i, i, 1);
-- 
2.25.1

