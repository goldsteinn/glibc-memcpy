From a667af65b5e36cdb27ef93a5c979de2f73d44bed Mon Sep 17 00:00:00 2001
From: Noah Goldstein <goldstein.w.n@gmail.com>
Date: Sun, 22 Aug 2021 23:08:24 -0400
Subject: [PATCH 13/14] optimize out nt branch on more8x

---
 sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S b/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
index 8c7da8d2b6..909c04c2f9 100644
--- a/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
+++ b/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
@@ -405,7 +405,7 @@ L(copy_8_15):
 	COPY_8_16
 	ret
 #endif
-	.p2align 4
+
 #if defined USE_MULTIARCH && IS_IN (libc)
 L(movsb_more_2x_vec):
 	cmp	__x86_rep_movsb_threshold(%rip), %RDX_LP
@@ -451,11 +451,11 @@ L(nop):
 	.p2align 4,, 10
 L(more_8x_vec):
 	/* Check if non-temporal move candidate.  */
-#if (defined USE_MULTIARCH || VEC_SIZE == 16) && IS_IN (libc)
-	/* Check non-temporal store threshold.  */
+#if (!defined USE_MULTIARCH && VEC_SIZE == 16) && IS_IN (libc)
 	cmp	__x86_shared_non_temporal_threshold(%rip), %RDX_LP
 	ja	L(large_memcpy_2x)
 #endif
+
 	/* Entry if rdx is greater than non-temporal threshold but there is
 	   overlap.  */
 L(more_8x_vec_check):
-- 
2.25.1

