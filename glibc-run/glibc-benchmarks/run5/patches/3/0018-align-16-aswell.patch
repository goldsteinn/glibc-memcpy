From 645c52088dff4f75905f27ea33afc278763c855b Mon Sep 17 00:00:00 2001
From: Noah Goldstein <goldstein.w.n@gmail.com>
Date: Mon, 23 Aug 2021 17:38:02 -0400
Subject: [PATCH 18/18] align 16 aswell

---
 sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S b/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
index f89fc74515..9592439213 100644
--- a/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
+++ b/sysdeps/x86_64/multiarch/memmove-vec-unaligned-erms.S
@@ -428,11 +428,13 @@ L(movsb):
 #  endif
 	movq	%rdi, %r8
 # endif
-# if AVOID_SHORT_DISTANCE_REP_MOVSB
+# if AVOID_SHORT_DISTANCE_REP_MOVSB || ALIGN_MOVSB
 	testl	$X86_STRING_CONTROL_AVOID_SHORT_DISTANCE_REP_MOVSB, __x86_string_control(%rip)
 	jz	L(skip_short_movsb_check)
+#  if AVOID_SHORT_DISTANCE_REP_MOVSB
 	cmpl	$-64, %ecx
 	jae	L(more_8x_vec_forward)
+#  endif
 # endif
 # if ALIGN_MOVSB
 	subq	%rdi, %rsi
-- 
2.25.1

